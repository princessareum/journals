angular.module("app",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(r,t){t.otherwise("/login"),r.state("login",{url:"/login",templateUrl:"./routes/login.html",controller:"loginController"}).state("signup",{url:"/signup",templateUrl:"./routes/signup.html",controller:"signupController"}).state("journalentry",{url:"/journalentry",templateUrl:"./routes/journal-entry.html",controller:"journalController",resolve:{user:["mainService","$state",function(r,t){return r.currentUser().then(function(r){return r})["catch"](function(r){t.go("login")})}]}}).state("group",{url:"/groups",templateUrl:"./routes/group.html",controller:"groupController",resolve:{user:["mainService",function(r){return r.currentUser().then(function(r){return r})["catch"](function(r){$state.go("login")})}]}}).state("album",{url:"/albums/:id",templateUrl:"./routes/album.html",controller:"albumController",resolve:{user:["mainService",function(r){return r.currentUser().then(function(r){return r})["catch"](function(r){$state.go("login")})}]}})}]);
angular.module("app").directive("fileread",["mainService",function(e){return{restrict:"A",link:function(n,o,t){o.bind("change",function(t){var a=new FileReader;a.onloadend=function(t){var a=t.target.result,i=o[0].value.split("\\"),r=i[i.length-1];console.log(n),e.storeImage(a,r,n.user).then(function(e){console.log(e),n.images.unshift(e),console.log(n.images)})["catch"](function(e){console.error(e)})},a.readAsDataURL(t.target.files[0])})}}}]);
angular.module("app").service("mainService",["$http",function(t){this.createUser=function(n){return t({method:"POST",url:"/auth",data:n}).then(function(t){return t.data})},this.login=function(n){return t({method:"POST",url:"/auth",data:n}).then(function(t){return t.data})},this.currentUser=function(){return t({method:"GET",url:"/api/user/current"}).then(function(t){return t.data})},this.getUser=function(n){return t({method:"GET",url:"/api/user/?_id="+n}).then(function(t){return t.data})},this.getUserByEmail=function(n){return t({method:"POST",url:"/api/user/email",data:{emails:n}}).then(function(t){return t.data})},this.postJournal=function(n){return t({method:"POST",url:"/api/journal",data:n}).then(function(t){return t.data})},this.getJournal=function(n){return t({method:"GET",url:"/api/journal?author="+n}).then(function(t){return t.data})},this.storeImage=function(n,r,e){var u=n.split(";")[0].split("/");u=u[u.length-1],console.log(e);var a={imageName:r,imageBody:n,imageExtension:u,userEmail:e.userEmail};return t.post("/api/newimage",a).then(function(t){return console.log(t),t.data})},this.createGroup=function(n){return t({method:"POST",url:"/api/group",data:n}).then(function(t){return t.data})},this.getGroup=function(n){return t({method:"GET",url:"/api/group?users="+n}).then(function(t){return t.data})},this.getGroupById=function(n){return t({method:"GET",url:"/api/group?_id="+n}).then(function(t){return t.data})},this.createAlbum=function(n){return t({method:"POST",url:"/api/album",data:n}).then(function(t){return t.data})},this.getAlbum=function(n){return t({method:"GET",url:"/api/album?group="+n}).then(function(t){return t.data})}}]);
angular.module("app").controller("albumController",["$scope","mainService","user","$stateParams",function(o,n,l,e){o.modalShown=!1,o.toggleModal=function(){o.modalShown=!o.modalShown},o.user=l,o.createAlbum=function(l){l.group=e.id,console.log(l),n.createAlbum(l).then(function(n){o.newAlbum=n,console.log(o.newAlbum),o.getAlbum(e.id)})},o.getAlbum=function(l){n.getAlbum(l).then(function(n){o.albums=n})},o.getAlbum(e.id),o.getJournal=function(){n.getJournal(o.user._id).then(function(n){o.journals=n,console.log(n)})},o.getJournal()}]);
angular.module("app").controller("groupController",["$scope","user","mainService",function(o,e,n){o.modalShown=!1,o.toggleModal=function(){o.modalShown=!o.modalShown},o.user=e,o.getGroup=function(){console.log(o.user,e),n.getGroup(o.user._id).then(function(e){o.groups=e})},o.getGroup(),o.getUserByEmail=function(e){var r=e.split(", ");console.log(r),n.getUserByEmail(r).then(function(e){o.groups.users=e,console.log(e),o.createGroup()})},o.createGroup=function(){o.groups.admin=o.user._id,n.createGroup(o.groups).then(function(e){o.newGroup=e,console.log(o.newGroup),o.getGroup()})},o.selectGroup=function(e){o.selectedGroup=e,console.log(o.selectedGroup)}}]);
angular.module("app").controller("journalController",["$scope","mainService","$state","user",function(o,n,e,u){o.images=[],o.user=u,o.postJournal=function(e){console.log(o.images),e.photo=o.images[0].Location,e.author=o.user._id,console.log(e.author),n.postJournal(e).then(function(n){o.newJournal=n,o.getJournal()})},o.getJournal=function(){n.getJournal(o.user._id).then(function(n){o.journals=n,console.log(n)})}}]);
angular.module("app").controller("loginController",["$scope","mainService","$state",function(n,e,o){n.getUser=function(){e.getUser(n.user._id).then(function(e){n.user=e})},n.login=function(t){e.login(t).then(function(t){t.login&&e.getUser(t.user._id).then(function(e){n.user=e,o.go("journalentry")})})}}]);
angular.module("app").controller("mainController",["$scope","mainService",function(n,o){}]);
angular.module("app").controller("signupController",["$scope","mainService",function(e,n){e.createUser=function(r){n.createUser(r).then(function(n){e.newUser=n})}}]);
angular.module("app").directive("albumDirective",function(){return console.log("Album directive javascript loaded"),{restrict:"E",replace:!0,templateUrl:"./js/directives/create-album.html"}});
angular.module("app").directive("groupDirective",function(){return console.log("group directive javascript loaded"),{restrict:"E",replace:!0,templateUrl:"./js/directives/create-group.html",link:function(){console.log("Group directive loaded")}}});